#### 1. VLAN协议
VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理LAN在逻辑上划分成多个广播域的通信技术。同一个LAN的主机间可以直接通信，不同LAN的主机则不行。协议标准：IEEE802.1Q

#### 2. VLAN数据帧格式
![[u=528095728,2910797150&fm=253&fmt=auto&app=138&f=PNG.webp|700]]
###### 字段解析
- 802.1Q组成结构：目的MAC地址+ 源MAC地址+ 802.1Q标记(tag) + 长度+ FCS
- **TPID** (Tag Protocol Identifier,标记协议标识符)：表示帧类型，取值为0x8100时表示 802.1Q标记帧。不支持802.1Q的设备收到会丢弃。
- **PRI** (Priority , 优先级)：表示帧的优先级，取值范围为0-7，当交换机阻塞时优先发送优先级高（数值大）的数据帧。
- **CFI** (Canonical Format Indicator，标准格式指示)：长度为1比特，表示MAC地址是否是标准格式。CFI可用于区分以太网帧、FDDI帧和令牌环网帧。在以太网中，CFI的值为0
- **VID** (VLAN ID)：取值范围为1～4094，协议规定0和4095为保留的VLAN ID。

##### 3. VLAN划分方法
1. **基于端口的划分**‌：常用方法，通过将交换机的物理端口或内部的PVC端口分配到不同的VLAN组中，形成独立的虚拟网。适用于任何规模的网络，定义VLAN成员时非常简单，缺点是如果用户更换端口，需要重新定义。‌

2. ‌**基于MAC地址的划分**‌：根据设备的MAC地址来划分VLAN。交换机通过学习主机的源MAC地址，将其划分到指定的VLAN中。这种方法适用于需要基于设备身份进行管理的网络环境。‌

3. ‌**基于IP地址的划分**‌：根据设备的IP地址或子网来划分VLAN。例如，可以将特定IP范围的设备划分到同一VLAN中。

4. ‌**基于协议类型的划分**‌：根据网络层协议类型（如IPv4、IPv6）来划分VLAN，适用于需要隔离不同协议设备的场景。‌

5. ‌**基于子网的划分**‌：根据设备的子网地址来划分VLAN，适用于需要按子网进行管理的网络环境。
    
6. ‌**动态VLAN划分**‌：根据用户登录时的身份认证信息动态划分VLAN，适用于需要对用户进行强制身份验证和权限控制的网络环境。


##### 4. 接口类型
在 802.1Q中定义 VLAN后，设备的有些接口可以识别 VLAN帧，有些接口不能识别 VLAN帧。根据对 VLAN帧的识别情况，将接口分为以下4类。
1. Access接口。Access接口是交换机上用来连接用户主机的接口，它只能连接接入链路。仅允许唯一的VLANID通过本接口，这个 VLANID与接口的缺省 VLANID相同，Access接口发往对端设备的以太网帧永远是不带标记的帧。
2. Trunk接口。Trunk接口是交换机上用来和其他交换机连接的接口，它只能连接干道链路，允许多个VLAN的帧（带VLAN标记）通过。
3. Hybrid接口。Hybrid接口是交换机上既可以连接用户主机，又可以连接其他交换机的接口。Hybrid 接口既可以连接接入链路又可以连接干道链路。Hybrid接口允许多个 VLAN的帧通过，并可以在出接口方向将某些VLAN帧的标记剥掉。
4. QinQ接口。QinQ(802.1Q-in-802.1Q)接口是使用QinQ协议的接口。QinQ接口可以给帧加上双重VLAN标记，即在原来标记的基础上，给帧加上一个新的标记，从而可以支持多达4094×4094个VLAN（不同的产品支持不同的规格)，满足网络对 VLAN数量的需求。
	- 外层的标记通常被称作公网标记，用来存放公网的VLANID。内层标记通常被称作私网标记，用来存放私网的VLANID。

> 附：华为交换机各类型接口对数据帧的处理方式
![[1273933-20180520225001696-397228935.png|1000]]
