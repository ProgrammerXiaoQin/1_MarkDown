##### 1. 简介
生成树协议STP（Spanning Tree Protocol）用于局域网中消除环路的协议 。运行该协议的设备通过彼此交互信息而发现网络中的环路，并适当 对某些端口进行阻塞以消除环路
	如果没有STP可能会导致：
- 广播风暴导致网络不可用
- MAC表震荡导致MAC表被破坏

##### 1.1 华为交换机生成树模式
1. 按交换机上可以定义的生成树示例与VLAN的对应关系，可以把交换机生成树模式分为实列模型，多生成树实例模型和基于VLAN生成树实列模型
2. 单实列模型，SST（Single STP）,交换机所有VLAN只能使用一个拓扑。华为交换机单实例模型只有使用STP和RSTP两种模式。
3. 多实列模型，MST（Multiple STP）,自定义拓扑实列数量，可手动关联哪些VLAN使用哪个实例。MSTP是华为默认生成树模式。
4. 基于VLAN实列模型，VBST（Vlan-based STP）,无法定义实例数量，每个VLAN都拥有各自生成树实列。实列与拓扑之间彼此独立不相关。一般只在特定交换机平台支持（多用于Cisco PVST+互操作使用），不建议使用，系统开销较大

> 一台交换机只能工作在一种模式下，华为使用 `stp mode {stp|rstp|mstp}` 在交换机上定义生成树模式，建议网络中所有交换机使用同种模式，MSTP是默认的建议模式

>IEEE802.d和IEEE802.w 是默契使用的STP算法，主要区别为计算无环树使用时间不同，STP使用802.d，RSTP使用802.w


##### 2. STP基本概念
1. STP基本概念包括交换机BID，端口ID，端口成本，端口状态，端口校色
2. BID（Bridge ID）
	1. IEEE 802.1D规定BID是由16位的桥优先级（Bridge Priority）与桥MAC地址构成。BID中，优先级占据高16位，其余低48位是MAC地址。高16位中，低12位定义为扩展的SystemID，在STP和RSTP中部分取值为0。
	2. 在STP网络中，桥ID最小的设备会被选举为根桥

![[BIGID.png]]

2. 端口ID
	1. 在参与生成树结算时，端口PID的大小可能会影响到是否被选举为指定端口。PID小者会被选举成指定端口
	2. PID：端口ID是2字节，其中，端口优先级占1字节，端口ID占据1字节。但在配置时端口优先级仅能配置高4位，后12位为端口号。默认下，端口优先级为128。
	3. `stp port priority` 可改变当前端口优先级，从而影响选举。

>端口优先级改变时，生成树协议会从新计算端口角色并进行状态迁移。

3. 端口成本